<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../static/layui/css/layui.css">
    <link rel="stylesheet" href="../../static/main/assets/css/view.css"/>
    <title>Portal</title>
    <style>
        layui-input-block{
           width:300px;
        }
    </style>
</head>
<body class="layui-view-body">
<div class="layui-content">
    <div class="layui-row">
        <div class="layui-card">
            <div class="layui-card-header">文档编辑</div>
            <form id="editForm" class="layui-card-body layui-form" action="#" lay-filter="editForm">
                <input type="hidden" name="id" />
                <input type="hidden" name="status" value="1"/>
                <div class="form-box" style="width:900px;">
                    <div class="layui-form-item">
                        <label class="layui-form-label">文件名：</label>
                        <div class="layui-input-block">
                            <input type="text" name="thirdFileName" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">简介：</label>
                        <div class="layui-input-block">
                            <textarea name="releaseIntroduction" placeholder="" class="layui-textarea"></textarea>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">用户权限：</label>
                        <div class="layui-input-block">
                            <input type="radio" name="operationalMode" value="0" title="可见" checked>
                            <input type="radio" name="operationalMode" value="1" title="可下载" >
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">权限配置：</label>
                        <div class="layui-input-block" style="border:1px solid #ccc;padding:10px;">
                            <div class="layui-inline">
                                <!--<div class="layui-form-mid">角色:</div>-->
                                <!--<div class="layui-input-inline" style="width: 150px;">-->
                                    <!--<select name="sex">-->
                                        <!--<option value="1">系统管理员</option>-->
                                    <!--</select>-->
                                <!--</div>-->
                                <div class="layui-form-mid">用户名:</div>
                                <div class="layui-input-inline" style="width: 150px;">
                                    <input type="text" autocomplete="off" class="layui-input" name="loginName" id="loginName"/>
                                </div>
                                <div class="layui-form-mid">区域:</div>
                                <div class="layui-input-inline" style="width: 150px;">
                                    <input type="text" autocomplete="off" class="layui-input" name="country" id="country"/>
                                </div>
                                <button class="layui-btn layui-btn-primary ">查询</button>
                            </div>
                            <table id="table" lay-filter="table-filter"></table>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <div class="layui-input-block">

                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button class="layui-btn layui-btn-blue" lay-submit lay-filter="formDemo" onclick="release()">发布</button>
                            <button type="reset" class="layui-btn layui-btn-primary" onclick="cancel()">取消</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script src='../../static/jquery/jquery-2.1.4.min.js'></script>
<script src="../../static/util/util.js" type="text/javascript" ></script>
<script src="../../static/layui/layui.all.js"></script>
<script type="text/javascript"  src="../../static/main/assets/js/su.js"></script>
<script>
    $(function() {
        load();
    });

    var element = layui.element;
    var table = layui.table;
    var form = layui.form;
    function load() {
        $.getJson("/archive/"+ $.getQueryString("id"), function(data){
                form.val("editForm", data)
                loadTable();
        });
    }

    function loadTable() {
        //展示已知数据
        table.render({
            elem: '#table'
            , url: '/user/list'
            , method: 'post'
            , contentType: 'application/json'
            , request: {pageName: 'pageNum', limitName: 'pageSize'}
            , where: {loginName: $('#loginName').val(), country:$('#country').val()}
            , parseData: function(res){
                return {
                    "code": res.code == 1 ? 0 : res.code,
                    "msg": res.msg,
                    "count": res.data.total,
                    "data": res.data.list
                };
            }
            , skin: 'line' //表格风格
            , even: true
            , page: true
            , limits: [10, 20, 30]
            , limit: 10
            , text: {
                none: '无数据'
            }
            , cols: [[ //标题栏
                {field: 'id', title: 'ID', minWidth: 30, hide:true}
                , {field: 'visible', title: '可见', minWidth: 40, unresize:true, toolbar: '#tableOprate1', hide:true}
                , {field: 'download', title: '下载', minWidth: 40, unresize:true, toolbar: '#tableOprate2', hide:true}
                , {field: 'download', title: '选择', minWidth: 40, unresize:true, type: 'checkbox'}
                , {field: 'loginName', title: '用户名', minWidth: 80, unresize:true}
                , {field: 'roleName', title: '角色', minWidth: 80, unresize:true}
                , {field: 'country', title: "区域", minWidth: 80, unresize:true}
            ]]
            ,done: function () {
//                $("[data-field='registId']").css('display','none');
//                $("[data-field='customerId']").css('display','none');
            }

        });
        //头工具栏事件
        table.on('toolbar(table-filter)', function(obj){
            if(obj.event === 'create'){
                showAddDialog();
            }
        });
        //监听行工具事件
        table.on('tool(table-filter)', function(obj){
            var data = obj.data //获得当前行数据
                ,layEvent = obj.event; //获得 lay-event 对应的值
            if(layEvent === 'preview'){

            }
        });
    }
    function release(){
        var json = $("#editForm").serializeJson();
        console.log(JSON.stringify(json));
        var selUserIds = table.checkStatus("table");
        var relations = [];
        $.each(selUserIds.data, function(i, item){
            relations.push({
                archiveId:json.id,
                userId:item.id
            });
        });
        console.log(JSON.stringify(relations));
        json['relations'] = relations;
        $.postJson("/archive/authorize", json, function(){
              alert("success");
//            redirectToDocument();
        });
    }
    function cancel(){
        redirectToDocument();
    }
    function redirectToDocument(){
        window.location.href = "/view/system/document.html";
    }
</script>
</body>

</html>