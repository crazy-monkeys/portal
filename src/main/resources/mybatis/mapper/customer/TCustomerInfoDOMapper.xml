<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.crazy.portal.dao.customer.CustomerInfoMapper">
  <resultMap id="BaseResultMap" type="com.crazy.portal.entity.customer.CustomerInfo">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="cust_type" jdbcType="INTEGER" property="custType" />
    <result column="cust_role" jdbcType="INTEGER" property="custRole" />
    <result column="cust_in_code" jdbcType="VARCHAR" property="custInCode" />
    <result column="cust_out_code" jdbcType="VARCHAR" property="custOutCode" />
    <result column="cust_name" jdbcType="VARCHAR" property="custName" />
    <result column="cust_abbreviation" jdbcType="VARCHAR" property="custAbbreviation" />
    <result column="cust_mobile" jdbcType="VARCHAR" property="custMobile" />
    <result column="cust_phone_no" jdbcType="VARCHAR" property="custPhoneNo" />
    <result column="cust_fax" jdbcType="VARCHAR" property="custFax" />
    <result column="cust_email" jdbcType="VARCHAR" property="custEmail" />
    <result column="cust_web" jdbcType="VARCHAR" property="custWeb" />
    <result column="corporate_assets" jdbcType="DECIMAL" property="corporateAssets" />
    <result column="corporate_number" jdbcType="INTEGER" property="corporateNumber" />
    <result column="corporate_parents" jdbcType="VARCHAR" property="corporateParents" />
    <result column="is_white_list" jdbcType="INTEGER" property="isWhiteList" />
    <result column="advantage_value" jdbcType="LONGVARCHAR" property="advantageValue" />
    <result column="advantage_introduction" jdbcType="LONGVARCHAR" property="advantageIntroduction" />
    <result column="business_introduction" jdbcType="LONGVARCHAR" property="businessIntroduction" />
    <result column="dealer_status" jdbcType="INTEGER" property="dealerStatus" />
    <result column="create_user" jdbcType="INTEGER" property="createUser" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_user" jdbcType="INTEGER" property="updateUser" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="register_time" jdbcType="TIMESTAMP" property="registerTime" />
    <result column="register_time_str" jdbcType="VARCHAR" property="registerTimeStr" />
    <result column="active" jdbcType="INTEGER" property="active" />
    <result column="is_license" jdbcType="INTEGER" property="isLicense"></result>
    <result column="business_type" jdbcType="INTEGER" property="businessType"/>
    <result column="customer_status" jdbcType="INTEGER" property="customerStatus"></result>
    <result column="is_potential" jdbcType="INTEGER" property="isPotential"></result>
    <result column="dealer_id" jdbcType="INTEGER" property="dealerId"></result>
    <result column="dealer_name" jdbcType="VARCHAR" property="dealerName"></result>
    <result column="sales_id" jdbcType="INTEGER" property="salesId"></result>
    <result column="sales_name" jdbcType="VARCHAR" property="salesName"></result>
  </resultMap>

  <!--代理商result-->
  <resultMap id="DealerResultMap" type="com.crazy.portal.entity.customer.CustomerInfo" extends="BaseResultMap">
    <association property="basicBank" resultMap="com.crazy.portal.dao.basic.BasicBankInfoMapper.BaseResultMap" />
    <collection property="basicAddress" resultMap="com.crazy.portal.dao.basic.BasicAddressMapper.BaseResultMap" />
    <collection property="basicLables" resultMap="com.crazy.portal.dao.basic.BasicLableMapper.BaseResultMap" />
    <collection property="basicFile" resultMap="com.crazy.portal.dao.basic.BasicFileMapper.BaseResultMap" />
    <collection property="basicContact" resultMap="com.crazy.portal.dao.basic.BasicContactMapper.BaseResultMap" />
    <collection property="basicShip" resultMap="com.crazy.portal.dao.basic.BasicCorporateRelationshipMapper.BaseResultMap" />
    <collection property="basicStructure" resultMap="com.crazy.portal.dao.basic.BasicCorporateStructureMapper.BaseResultMap" />
    <collection property="basicInvoice" resultMap="com.crazy.portal.dao.basic.BasicInvoiceInfoMapper.BaseResultMap" />
  </resultMap>


  <sql id="Base_Column_List">
    id, cust_type, cust_role, cust_in_code, cust_out_code, cust_name,
    cust_abbreviation, cust_mobile, cust_phone_no, cust_fax, cust_email, cust_web, corporate_assets, 
    corporate_number, corporate_parents,
    is_white_list, dealer_status, create_user, create_time, update_user, update_time, 
    active, advantage_value, advantage_introduction, business_introduction, is_license,
    business_type, customer_status, DATE_FORMAT(register_time,   '%Y-%m-%d %H:%i:%S') as register_time_str,
    is_potential
  </sql>

  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from t_customer_info
    where id = #{id,jdbcType=INTEGER} and active = 1
  </select>

  <update id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    update t_customer_info set active = 0,update_user=#{userId},update_time=now()
    where id = #{id,jdbcType=INTEGER}
  </update>

  <insert id="insertSelective" parameterType="com.crazy.portal.entity.customer.CustomerInfo" useGeneratedKeys="true" keyProperty="id">
    insert into t_customer_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="custType != null">
        cust_type,
      </if>
      <if test="custRole != null">
        cust_role,
      </if>
      <if test="custInCode != null">
        cust_in_code,
      </if>
      <if test="custOutCode != null">
        cust_out_code,
      </if>
      <if test="custName != null">
        cust_name,
      </if>
      <if test="custAbbreviation != null">
        cust_abbreviation,
      </if>
      <if test="custMobile != null">
        cust_mobile,
      </if>
      <if test="custPhoneNo != null">
        cust_phone_no,
      </if>
      <if test="custFax != null">
        cust_fax,
      </if>
      <if test="custEmail != null">
        cust_email,
      </if>
      <if test="custWeb != null">
        cust_web,
      </if>
      <if test="corporateAssets != null">
        corporate_assets,
      </if>
      <if test="corporateNumber != null">
        corporate_number,
      </if>
      <if test="corporateParents != null">
        corporate_parents,
      </if>
      <if test="isWhiteList != null">
        is_white_list,
      </if>
      <if test="dealerStatus != null">
        dealer_status,
      </if>
      <if test="createUser != null">
        create_user,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateUser != null">
        update_user,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="active != null">
        active,
      </if>
      <if test="advantageValue != null">
        advantage_value,
      </if>
      <if test="advantageIntroduction != null">
        advantage_introduction,
      </if>
      <if test="businessIntroduction != null">
        business_introduction,
      </if>
      <if test="isLicense != null">
        is_license,
      </if>
      <if test="businessType != null">
        business_type,
      </if>
      <if test="customerStatus != null">
        customer_status,
      </if>
      <if test="registerTime != null">
        register_time,
      </if>
      <if test="isPotential != null">
        is_potential,
      </if>
      <if test="dealerId != null">
        dealer_id,
      </if>
      <if test="salesId != null">
        sales_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="custType != null">
        #{custType,jdbcType=INTEGER},
      </if>
      <if test="custRole != null">
        #{custRole,jdbcType=INTEGER},
      </if>
      <if test="custInCode != null">
        #{custInCode,jdbcType=VARCHAR},
      </if>
      <if test="custOutCode != null">
        #{custOutCode,jdbcType=VARCHAR},
      </if>
      <if test="custName != null">
        #{custName,jdbcType=VARCHAR},
      </if>
      <if test="custAbbreviation != null">
        #{custAbbreviation,jdbcType=VARCHAR},
      </if>
      <if test="custMobile != null">
        #{custMobile,jdbcType=VARCHAR},
      </if>
      <if test="custPhoneNo != null">
        #{custPhoneNo,jdbcType=VARCHAR},
      </if>
      <if test="custFax != null">
        #{custFax,jdbcType=VARCHAR},
      </if>
      <if test="custEmail != null">
        #{custEmail,jdbcType=VARCHAR},
      </if>
      <if test="custWeb != null">
        #{custWeb,jdbcType=VARCHAR},
      </if>
      <if test="corporateAssets != null">
        #{corporateAssets,jdbcType=DECIMAL},
      </if>
      <if test="corporateNumber != null">
        #{corporateNumber,jdbcType=INTEGER},
      </if>
      <if test="corporateParents != null">
        #{corporateParents,jdbcType=VARCHAR},
      </if>
      <if test="isWhiteList != null">
        #{isWhiteList,jdbcType=INTEGER},
      </if>
      <if test="dealerStatus != null">
        #{dealerStatus,jdbcType=INTEGER},
      </if>
      <if test="createUser != null">
        #{createUser,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null">
        #{updateUser,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="active != null">
        #{active,jdbcType=INTEGER},
      </if>
      <if test="advantageValue != null">
        #{advantageValue,jdbcType=LONGVARCHAR},
      </if>
      <if test="advantageIntroduction != null">
        #{advantageIntroduction,jdbcType=LONGVARCHAR},
      </if>
      <if test="businessIntroduction != null">
        #{businessIntroduction,jdbcType=LONGVARCHAR},
      </if>
      <if test="isLicense != null">
        #{isLicense,jdbcType=INTEGER},
      </if>
      <if test="businessType != null">
        #{businessType,jdbcType=INTEGER},
      </if>
      <if test="customerStatus != null">
        #{customerStatus,jdbcType=INTEGER},
      </if>
      <if test="registerTime != null">
        #{registerTime,jdbcType=VARCHAR},
      </if>
      <if test="isPotential != null">
        #{isPotential,jdbcType=INTEGER},
      </if>
      <if test="dealerId != null">
        #{dealerId,jdbcType=INTEGER},
      </if>
      <if test="salesId != null">
        #{salesId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.crazy.portal.entity.customer.CustomerInfo">
    update t_customer_info
    <set>
      <if test="custType != null">
        cust_type = #{custType,jdbcType=INTEGER},
      </if>
      <if test="custRole != null">
        cust_role = #{custRole,jdbcType=INTEGER},
      </if>
      <if test="custInCode != null">
        cust_in_code = #{custInCode,jdbcType=VARCHAR},
      </if>
      <if test="custOutCode != null">
        cust_out_code = #{custOutCode,jdbcType=VARCHAR},
      </if>
      <if test="custName != null">
        cust_name = #{custName,jdbcType=VARCHAR},
      </if>
      <if test="custAbbreviation != null">
        cust_abbreviation = #{custAbbreviation,jdbcType=VARCHAR},
      </if>
      <if test="custMobile != null">
        cust_mobile = #{custMobile,jdbcType=VARCHAR},
      </if>
      <if test="custPhoneNo != null">
        cust_phone_no = #{custPhoneNo,jdbcType=VARCHAR},
      </if>
      <if test="custFax != null">
        cust_fax = #{custFax,jdbcType=VARCHAR},
      </if>
      <if test="custEmail != null">
        cust_email = #{custEmail,jdbcType=VARCHAR},
      </if>
      <if test="custWeb != null">
        cust_web = #{custWeb,jdbcType=VARCHAR},
      </if>
      <if test="corporateAssets != null">
        corporate_assets = #{corporateAssets,jdbcType=DECIMAL},
      </if>
      <if test="corporateNumber != null">
        corporate_number = #{corporateNumber,jdbcType=INTEGER},
      </if>
      <if test="corporateParents != null">
        corporate_parents = #{corporateParents,jdbcType=VARCHAR},
      </if>
      <if test="isWhiteList != null">
        is_white_list = #{isWhiteList,jdbcType=INTEGER},
      </if>
      <if test="dealerStatus != null">
        dealer_status = #{dealerStatus,jdbcType=INTEGER},
      </if>
      <if test="createUser != null">
        create_user = #{createUser,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null">
        update_user = #{updateUser,jdbcType=INTEGER},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="active != null">
        active = #{active,jdbcType=INTEGER},
      </if>
      <if test="advantageValue != null">
        advantage_value = #{advantageValue,jdbcType=LONGVARCHAR},
      </if>
      <if test="advantageIntroduction != null">
        advantage_introduction = #{advantageIntroduction,jdbcType=LONGVARCHAR},
      </if>
      <if test="businessIntroduction != null">
        business_introduction = #{businessIntroduction,jdbcType=LONGVARCHAR},
      </if>
      <if test="isLicense != null">
        is_license = #{isLicense,jdbcType=INTEGER},
      </if>
      <if test="businessType != null">
        business_type = #{businessType,jdbcType=INTEGER},
      </if>
      <if test="customerStatus != null">
        customer_status = #{customerStatus,jdbcType=INTEGER},
      </if>
      <if test="registerTime != null">
        register_time = #{registerTime,jdbcType=VARCHAR},
      </if>
      <if test="isPotential != null">
        is_potential = #{isPotential,jdbcType=INTEGER},
      </if>
      <if test="dealerId != null">
        dealer_id = #{dealerId,jdbcType=INTEGER},
      </if>
      <if test="salesId != null">
        sales_id = #{salesId,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>

  <select id="selectDealerInfo" resultMap="DealerResultMap">
    select
    cust.id,
    cust.cust_in_code,
    cust.cust_name,
    cust.cust_abbreviation,
    cust.cust_mobile,
    cust.cust_email,
    cust.cust_web,
    cust.corporate_assets,
    cust.corporate_number,
    cust.register_time,
    cust.corporate_parents,
    cust.advantage_value,
    cust.advantage_introduction,
    cust.business_introduction,
    adr.id,
    adr.cust_id,
    adr.address_type,
    adr.province,
    adr.city,
    adr.district,
    adr.detail_info,
    bank.id,
    bank.cust_id,
    bank.bank_name,
    CONCAT_WS('',bank.bank_country,bank.bank_province,bank.bank_city,bank.bank_district,bank.bank_detail_info) as bank_address,
    bank.bank_account,
    bank.bank_bic,
    ship.id,
    ship.cust_id,
    ship.corporate_name,
    ship.corporate_type,
    contact.id,
    contact.cust_id,
    contact.contact_name,
    contact.contact_mobile,
    contact.contact_email,
    contact.contact_department,
    contact.contact_position,
    contact.is_decision_maker,
    contact.equity_ratio,
    invoice.id,
    invoice.cust_id,
    invoice.purchasing_unit,
    invoice.shipping_address,
    invoice.shipping_mobile,
    invoice.taxpayer_registration_number,
    invoice.currency,
    file.id,
    file.cust_id,
    file.file_type,
    file.file_name,
    file.file_path,
    file.create_time
    from t_customer_info cust
    left join t_basic_lable lable on cust.id = lable.cust_id and lable.active=1
    left join t_basic_file file on file.cust_id = cust.id and file.active=1
    left join t_basic_contact contact on cust.id = contact.cust_id and contact.active=1
    left join t_basic_corporate_structure str on cust.id = str.cust_id and str.active=1
    left join t_basic_corporate_relationship ship on cust.id = ship.cust_id and ship.active=1
    left join t_basic_bank_info bank on cust.id = bank.cust_id and bank.active=1
    left join t_basic_invoice_info invoice on cust.id = invoice.cust_id and invoice.active=1
    left join t_basic_address adr on cust.id = adr.cust_id and adr.active=1
    where cust.id= #{dealerId}
  </select>

  <select id="selectCustByPage" resultMap="BaseResultMap" parameterType="com.crazy.portal.bean.customer.CustomerQueryBean">
    select
    a.id, a.cust_type, a.cust_role, a.cust_in_code, a.cust_out_code, a.cust_name,
    a.cust_abbreviation, a.cust_mobile, a.cust_phone_no, a.cust_fax, a.cust_email, a.cust_web, a.corporate_assets,
    a.corporate_number, a.corporate_parents,
    a.is_white_list, a.dealer_status, a.create_user, a.create_time, a.update_user, a.update_time,
    a.active, a.advantage_value, a.advantage_introduction, a.business_introduction, a.is_license,
    a.business_type, a.customer_status, DATE_FORMAT(a.register_time,   '%Y-%m-%d %H:%i:%S') as register_time_str,
    a.is_potential, a.sales_id, b.cust_name as dealer_name
    from t_customer_info a
    left join t_customer_info b on b.id = a.dealer_id
    where a.active = 1 and a.create_user = #{userId}
    <if test="customerName != null and customerName != ''">
      and a.cust_name like concat('%',#{customerName},'%')
    </if>
    <if test="customerInCode != null and customerInCode != ''">
      and a.cust_in_code like concat('%',#{customerInCode},'%')
    </if>
    <if test="customerOutCode != null and customerOutCode != ''">
      and a.cust_out_code like concat('%',#{customerOutCode},'%')
    </if>
    <if test="isLicense != null">
      and a.is_license = #{isLicense}
    </if>
    <if test="businessType != null and businessType != ''">
      and a.business_type = #{businessType}
    </if>
    <if test="reportStartDate != null and reportEndDate != null and reportStartDate != '' and reportEndDate != ''">
      and a.register_time between str_to_date(#{reportStartDate}, '%Y-%m-%d') and str_to_date(#{reportEndDate}, '%Y-%m-%d')
    </if>
    <if test="createStartDate != null and createEndDate != null and createStartDate != '' and createEndDate != ''">
      and a.create_time between str_to_date(#{createStartDate}, '%Y-%m-%d') and str_to_date(#{createEndDate}, '%Y-%m-%d')
    </if>
    <if test="customerStatus != null and customerStatus != 1">
      and a.customer_status = #{customerStatus}
    </if>
    <if test="customerStatus != null and customerStatus == 1">
      and a.customer_status in (1,4)
    </if>
  </select>

  <select id="selectByCustName" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from t_customer_info
    where active = 1 and cust_name = #{custName}
  </select>

  <select id="selectNameAndCodeByUserId" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select cust_name, cust_in_code from t_customer_info
    where active = 1 and create_user = #{userId}
  </select>

  <select id="selectAllCustomer" resultMap="BaseResultMap">
    select id,cust_out_code,cust_name from t_customer_info
    order by create_time desc
  </select>
</mapper>